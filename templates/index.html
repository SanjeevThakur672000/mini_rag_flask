<!DOCTYPE html>
<html>
<head>
  <title>Mini RAG - Flask</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
  <h2 class="mb-3">Mini RAG App (Track B)</h2>

  <div class="card p-3 mb-4">
    <h4>1) Paste Text & Ingest</h4>
    <form id="ingestForm">
      <textarea class="form-control mb-2" name="text" rows="5" placeholder="Paste your document here..."></textarea>
      <button class="btn btn-primary">Ingest</button>
    </form>
    <div id="ingestResult" class="mt-2 text-success"></div>
  </div>

  <div class="card p-3">
    <h4>2) Ask Question</h4>
    <form id="askForm">
      <input class="form-control mb-2" name="query" placeholder="Ask a question..." />
      <button class="btn btn-success">Ask</button>
    </form>

    <div class="mt-3">
      <h5>Answer</h5>
      <p id="answerBox"></p>

      <h5>Sources</h5>
      <ul id="sourcesList"></ul>

      <p class="text-muted" id="timingBox"></p>
    </div>
  </div>
</div>

<script>
document.getElementById("ingestForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);

  const res = await fetch("/ingest", { method: "POST", body: formData });
  const data = await res.json();

  document.getElementById("ingestResult").innerText =
    data.message ? `${data.message} | chunks: ${data.chunks} | time: ${data.time_ms}ms`
                 : `Error: ${data.error}`;
});

document.getElementById("askForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);

  const res = await fetch("/ask", { method: "POST", body: formData });
  const data = await res.json();

  document.getElementById("answerBox").innerText = data.answer || data.error;

  const list = document.getElementById("sourcesList");
  list.innerHTML = "";

  if (data.sources) {
    data.sources.forEach(s => {
      const li = document.createElement("li");
      li.innerText = `[${s.id}] ${s.title} | pos=${s.position ?? s.chunk_id} | ${s.snippet}`;
      list.appendChild(li);
    });
  }

  document.getElementById("timingBox").innerText = data.time_ms ? `Time: ${data.time_ms} ms` : "";
});
</script>
</body>
</html>
